<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>스위스 라운드 매칭 도우미 v7.1 (타이머 추가)</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"><style>:root{--primary-color:#0d6efd;--background-color:#1a1a1a;--surface-color:#2c2c2c;--text-color:#e0e0e0;--border-color:#444}body{background-color:var(--background-color);color:var(--text-color);font-family:Pretendard,sans-serif}.container-main{max-width:800px;margin:2rem auto;padding:2rem}h2{font-weight:600;border-bottom:2px solid var(--primary-color);padding-bottom:.5rem;margin-bottom:1.5rem;color:#fff}.form-control,.form-range,.form-select{background-color:var(--surface-color);color:var(--text-color);border-color:var(--border-color)}.form-control:focus,.form-range:focus,.form-select:focus{background-color:#333;color:var(--text-color);border-color:var(--primary-color);box-shadow:0 0 0 .25rem rgba(13,110,253,.25)}.form-control::placeholder{color:#888}.view{transition:opacity .3s ease-in-out,transform .3s ease-in-out;will-change:opacity,transform}.hidden{display:block!important;opacity:0;transform:translateY(10px);pointer-events:none;position:absolute;width:100%}.match-card{border:1px solid var(--border-color);border-radius:12px;padding:20px;margin-bottom:20px;background-color:var(--surface-color);display:flex;flex-direction:column;gap:16px;box-shadow:0 4px 15px rgba(0,0,0,.2);transition:transform .2s ease,box-shadow .2s ease}.match-card:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,.3)}.player-name{font-weight:600;font-size:1.2rem;text-align:center;color:#fff}.vs-text{text-align:center;font-size:1rem;font-weight:700;color:var(--primary-color);margin:0}.radio-group{display:flex;justify-content:center;flex-wrap:wrap;gap:10px}.radio-box label{display:inline-block;padding:10px 16px;border:1px solid var(--border-color);border-radius:8px;background-color:#3e3e3e;color:var(--text-color);cursor:pointer;font-family:monospace;font-size:1.1rem;user-select:none;min-width:45px;text-align:center;transition:all .2s ease}.radio-box input[type=radio]{display:none}.radio-box input[type=radio]:checked+label{background-color:var(--primary-color);color:#fff;border-color:var(--primary-color);font-weight:700;transform:scale(1.1)}.radio-box label:hover{background-color:#555;border-color:#777}.result-table{width:100%;margin:auto;font-size:1rem;text-align:center;border-collapse:separate;border-spacing:0;margin-bottom:1.5rem;background-color:var(--surface-color);border-radius:12px;overflow:hidden;box-shadow:0 4px 15px rgba(0,0,0,.2)}.result-table td,.result-table th{padding:12px 10px;border-bottom:1px solid var(--border-color)}.result-table th{background-color:#333;color:#fff;font-weight:600}.result-table tbody tr:last-child td{border-bottom:none}.result-table tbody tr:nth-child(even){background-color:rgba(0,0,0,.1)}.result-table td.name{text-align:left;padding-left:20px;font-weight:600;display:flex;align-items:center;gap:.5em}.result-table td.elo{font-weight:700;color:#ffc107}.result-table td.winrate-high{color:#198754;font-weight:700}.result-table td.winrate-low{color:#dc3545}tr.full-win{background:linear-gradient(270deg,rgba(255,215,0,.1),rgba(255,100,100,.1),rgba(100,150,255,.1),rgba(255,215,0,.1));background-size:600% 600%;animation:bgSlide 5s ease infinite}.full-win .crown{animation:crownScale 1.5s ease-in-out infinite;font-size:1.2em;color:gold}@keyframes bgSlide{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}@keyframes crownScale{0%{transform:scale(1)}50%{transform:scale(1.25) rotate(5deg)}100%{transform:scale(1)}}#timerDisplay{font-family:monospace,Pretendard;font-size:2rem;font-weight:700;color:#0d6efd;transition:color .5s}#timerDisplay.ending{color:#dc3545;animation:blink 1s step-end infinite}@keyframes blink{50%{opacity:.5}}.timer-settings{width:150px}</style></head><body><div class="container-main"><div id="setupView" class="view"><h2>게임 설정</h2><div class="mb-3"><label class="form-label">게임 형식</label> <select id="matchFormat" class="form-select"><option value="1">Bo1</option><option value="2" selected="selected">Bo3</option><option value="3">Bo5</option></select></div><div class="mb-3"><label class="form-label">최대 라운드 수</label> <input type="number" id="maxRounds" class="form-control" value="3" min="1"></div><div class="mb-3"><label class="form-label">참가자 명단 (줄마다 한 명)</label> <textarea id="playersInput" class="form-control" rows="5" placeholder="줄마다 이름 입력 (최소 4명)"></textarea></div><div class="mb-3"><button class="btn btn-sm btn-primary me-2" id="savePlayerList" disabled="disabled">명단 저장</button> <button class="btn btn-sm btn-outline-secondary" id="loadPlayerList">명단 불러오기</button></div><button class="btn btn-primary btn-lg w-100" id="startBtn">게임 시작</button></div><div id="gameView" class="view hidden"><div class="d-flex justify-content-between align-items-center mb-3 flex-wrap"><h2>라운드 <span id="roundNum">1</span> / <span id="totalRounds"></span></h2><div class="d-flex align-items-center gap-4 flex-wrap"><button class="btn btn-outline-light" id="timerStartBtn">타이머 시작</button><div id="timerDisplay">00:00</div><div class="timer-settings"><label for="timerSlider" class="form-label mb-0">타이머: <span id="timerValueLabel">60</span>분</label> <input type="range" class="form-range" min="1" max="90" step="5" value="60" id="timerSlider"></div></div></div><div id="pairings"></div><div class="mt-4 d-flex justify-content-between"><button class="btn btn-secondary" id="backBtn">뒤로가기</button><div><button class="btn btn-success me-2" id="nextRoundBtn">다음 라운드</button> <button class="btn btn-warning" id="viewResultBtn" disabled="disabled">결과 보기</button></div></div></div><div id="resultView" class="view hidden"><h2>최종 결과</h2><div id="resultSummary" class="mb-4"></div><div class="d-flex gap-2"><button class="btn btn-primary flex-grow-1" id="replayBtn">동일 설정으로 다시 하기</button> <button class="btn btn-secondary flex-grow-1" id="editLastResultBtn">결과 재기입</button> <button class="btn btn-outline-light flex-grow-1" id="resetBtn">처음부터 다시</button></div></div></div><div id="timerOverlay" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,.8);display:none;justify-content:center;align-items:center;z-index:99999;color:#fff;font-size:2rem;flex-direction:column"><button class="btn btn-danger mt-3" id="overlayResetBtn">타이머 초기화</button></div><script>let isTimerRunning=!1,setupView=document.getElementById("setupView"),gameView=document.getElementById("gameView"),resultView=document.getElementById("resultView"),roundNum=document.getElementById("roundNum"),totalRounds=document.getElementById("totalRounds"),pairingsDiv=document.getElementById("pairings"),nextRoundBtn=document.getElementById("nextRoundBtn"),viewResultBtn=document.getElementById("viewResultBtn"),resultSummary=document.getElementById("resultSummary"),timerDisplay=document.getElementById("timerDisplay"),timerSlider=document.getElementById("timerSlider"),timerValueLabel=document.getElementById("timerValueLabel"),timerBtn=document.getElementById("timerStartBtn"),players=(timerBtn.addEventListener("click",()=>{!1===isTimerRunning?(startTimer(parseInt(timerSlider.value)),isTimerRunning=!0,timerBtn.textContent="타이머 초기화",document.getElementById("nextRoundBtn").disabled=!0,document.getElementById("viewResultBtn").disabled=!0,document.getElementById("backBtn").disabled=!0):(stopTimer(),isTimerRunning=!1,timerBtn.textContent="타이머 시작",timerSlider.value=60,timerValueLabel.textContent="60",document.getElementById("nextRoundBtn").disabled=!1,document.getElementById("viewResultBtn").disabled=!1,document.getElementById("backBtn").disabled=!1)}),["nextRoundBtn","viewResultBtn","backBtn"].forEach(e=>{document.getElementById(e).addEventListener("click",e=>{!0===isTimerRunning&&(e.preventDefault(),showToast("타이머 실행 중에는 사용할 수 없습니다."))})}),[]),matchFormat=2,maxRounds=3,currentRound=1,allPairings=[],matchResults=[],matchHistory=new Map,timerInterval=null,audioCtx=null;function initAudio(){audioCtx=audioCtx||new(window.AudioContext||window.webkitAudioContext)}function updateDisplay(e){timerDisplay.textContent=formatTime(e),e<=60?timerDisplay.classList.add("ending"):timerDisplay.classList.remove("ending")}function playAlarmSound(){var e,t;audioCtx&&(e=audioCtx.createOscillator(),t=audioCtx.createGain(),e.connect(t),t.connect(audioCtx.destination),e.type="sine",e.frequency.setValueAtTime(880,audioCtx.currentTime),t.gain.setValueAtTime(.5,audioCtx.currentTime),e.start(audioCtx.currentTime),e.stop(audioCtx.currentTime+.15),setTimeout(()=>{var e=audioCtx.createOscillator(),t=audioCtx.createGain();e.connect(t),t.connect(audioCtx.destination),e.type="sine",e.frequency.setValueAtTime(880,audioCtx.currentTime),t.gain.setValueAtTime(.5,audioCtx.currentTime),e.start(audioCtx.currentTime),e.stop(audioCtx.currentTime+.15)},300),setTimeout(()=>{var e=audioCtx.createOscillator(),t=audioCtx.createGain();e.connect(t),t.connect(audioCtx.destination),e.type="sine",e.frequency.setValueAtTime(880,audioCtx.currentTime),t.gain.setValueAtTime(.5,audioCtx.currentTime),e.start(audioCtx.currentTime),e.stop(audioCtx.currentTime+.15)},600))}function formatTime(e){return Math.floor(e/60).toString().padStart(2,"0")+":"+(e%60).toString().padStart(2,"0")}function stopTimer(){null!==timerInterval&&(clearInterval(timerInterval),timerInterval=null),timerDisplay.classList.remove("ending")}function startTimer(e){null!==timerInterval&&clearInterval(timerInterval);let t=60*e;updateDisplay(t),timerInterval=setInterval(()=>{updateDisplay(--t),t<=0&&(clearInterval(timerInterval),timerInterval=null,playAlarmSound(),document.getElementById("timerOverlay").style.display="flex")},1e3)}function showToast(e){let t=document.createElement("div");t.textContent=e,t.style.cssText=`
				position: fixed;
				bottom: 2rem;
				left: 50%;
				transform: translateX(-50%);
				background: #333;
				color: white;
				padding: 0.75rem 1.5rem;
				border-radius: 0.5rem;
				box-shadow: 0 2px 10px rgba(0,0,0,0.3);
				z-index: 9999;
				font-weight: bold;
			`,document.body.appendChild(t),setTimeout(()=>t.remove(),2e3)}function resetTimerUI(){stopTimer(),isTimerRunning=!1,document.getElementById("timerStartBtn").textContent="타이머 시작",document.getElementById("timerSlider").disabled=!1,document.getElementById("timerSlider").value=60,document.getElementById("timerValueLabel").textContent="60",document.getElementById("nextRoundBtn").disabled=!1,document.getElementById("viewResultBtn").disabled=!1,document.getElementById("backBtn").disabled=!1,document.getElementById("timerOverlay").style.display="none"}function switchView(e,t){e.classList.add("hidden"),setTimeout(()=>{t.classList.remove("hidden")},300)}function isValidName(e){e=e.trim();return!(""===e||!/^[\uAC00-\uD7A3]{1,5}$/.test(e)&&!/^[a-zA-Z0-9 ]{1,16}$/.test(e))}function validatePlayerInput(){var e=document.getElementById("playersInput").value.split("\n").map(e=>e.trim()).filter(e=>""!==e).filter(isValidName);document.getElementById("savePlayerList").disabled=!(4<=e.length&&e.length<=16)}function hasPlayed(e,t){return matchHistory.get(e)?.includes(t)||!1}function addMatchHistory(e,t){matchHistory.has(e)||matchHistory.set(e,[]),matchHistory.has(t)||matchHistory.set(t,[]),matchHistory.get(e).push(t),matchHistory.get(t).push(e)}function generatePairings(){var a=[...players].sort(()=>Math.random()-.5),e=[],r=new Set;for(let n=0;n<a.length;n++)if(!r.has(n)){let t=-1;for(let e=n+1;e<a.length;e++)if(!r.has(e)&&!hasPlayed(a[n],a[e])){t=e;break}if(-1===t)for(let e=n+1;e<a.length;e++)if(!r.has(e)){t=e;break}-1!==t?(e.push([a[n],a[t]]),r.add(n),r.add(t),addMatchHistory(a[n],a[t])):(e.push([a[n],null]),r.add(n))}return e}function renderPairings(e,d){pairingsDiv.innerHTML="",e.forEach(([e,t],n)=>{var a,r,i,l=document.createElement("div");l.className="match-card",t?(r=(i=(t,n)=>{let a="";for(let e=0;e<=matchFormat;e++){var r=n===e?"checked":"";a+=`
                            <span class="radio-box">
                                <input type="radio" name="${t}" id="${t}_${e}" value="${e}" ${r}>
                                <label for="${t}_${e}">${e}</label>
                            </span>
                        `}return a})("match"+n,(a=matchResults[d]?.[n]??[null,null])[0]),i=i(`match${n}_b`,a[1]),l.innerHTML=`
                    <div class="player-name">${e}</div>
                    <div class="radio-group">${r}</div>
                    <div class="vs-text">vs</div>
                    <div class="player-name">${t}</div>
                    <div class="radio-group">${i}</div>
                `):l.innerHTML=`<div class="player-name">${e}</div><div style="text-align:center;">부전승입니다.</div>`,pairingsDiv.appendChild(l)}),nextRoundBtn.disabled=currentRound>=maxRounds,viewResultBtn.disabled=currentRound<maxRounds}function calculateElo(e,t,n,a=32){return e+a*(n-1/(1+Math.pow(10,(t-e)/400)))}function renderFinalResults(){let t=new Map;players.forEach(e=>{t.set(e,{name:e,played:0,win:0,lose:0,draw:0,elo:1e3})});for(let e=0;e<allPairings.length;e++){var n=allPairings[e],a=matchResults[e];for(let e=0;e<n.length;e++){var r,i,[l,d]=n[e];a&&Array.isArray(a[e])&&([r,i]=a[e],l=t.get(l),d?(d=t.get(d),l.played+=1,d.played+=1,i<r?(l.win+=1,d.lose+=1,l.elo=calculateElo(l.elo,d.elo,1),d.elo=calculateElo(d.elo,l.elo,0)):r<i?(d.win+=1,l.lose+=1,l.elo=calculateElo(l.elo,d.elo,0),d.elo=calculateElo(d.elo,l.elo,1)):(l.draw+=1,d.draw+=1,l.elo=calculateElo(l.elo,d.elo,.5),d.elo=calculateElo(d.elo,l.elo,.5))):(l.played+=1,l.win+=1,l.elo+=8))}}var e=[...t.values()].sort((e,t)=>t.elo-e.elo);let u=`
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>순위</th><th>이름</th><th>경기수</th><th>승</th><th>패</th><th>무</th><th>승률</th><th>ELO</th>
                        </tr>
                    </thead><tbody>
            `;e.forEach((e,t)=>{var n=0<e.played?((e.win+.5*e.draw)/e.played*100).toFixed(1):"0.0",a=100<=n?"winrate-high":n<=33?"winrate-low":"",r=0<e.played&&e.win===e.played;u+=`<tr class="${r?"full-win":""}">
                    <td class="rank">${t+1}</td>
                    <td class="name">${r?'<span class="crown">👑</span> ':""}${e.name}</td>
                    <td>${e.played}</td>
                    <td>${e.win}</td>
                    <td>${e.lose}</td>
                    <td>${e.draw}</td>
                    <td class="winrate ${a}">${n}%</td>
                    <td class="elo">${Math.round(e.elo)}</td>
                </tr>`}),u+="</tbody></table>",resultSummary.innerHTML=u}timerSlider.addEventListener("input",e=>{timerValueLabel.textContent=e.target.value}),document.getElementById("overlayResetBtn").addEventListener("click",resetTimerUI),document.getElementById("timerOverlay").addEventListener("click",resetTimerUI),document.getElementById("playersInput").addEventListener("input",validatePlayerInput),document.getElementById("savePlayerList").addEventListener("click",()=>{var e=document.getElementById("playersInput").value.split("\n").map(e=>e.trim()).filter(e=>isValidName(e));4<=e.length&&e.length<=16?(localStorage.setItem("swiss-last-players",e.join("\n")),alert("참가자 명단이 저장되었습니다.")):alert("유효한 이름 4~16명을 입력해주세요.")}),document.getElementById("loadPlayerList").addEventListener("click",()=>{var e=localStorage.getItem("swiss-last-players");e?(document.getElementById("playersInput").value=e,validatePlayerInput(),alert("저장된 참가자 명단을 불러왔습니다.")):alert("저장된 명단이 없습니다.")}),document.getElementById("editLastResultBtn").onclick=()=>{currentRound=maxRounds,roundNum.textContent=currentRound,switchView(resultView,gameView),renderPairings(allPairings[currentRound-1],currentRound-1),stopTimer()},window.addEventListener("DOMContentLoaded",()=>{var e=localStorage.getItem("swiss-last-players");e&&(document.getElementById("playersInput").value=e,validatePlayerInput()),timerValueLabel.textContent=timerSlider.value}),document.getElementById("startBtn").onclick=()=>{if((players=document.getElementById("playersInput").value.trim().split("\n").filter(e=>e)).length<4)return alert("최소 4명 이상 필요");var e;new Set(players).size<players.length?alert("동일한 이름이 2개 이상 있습니다. 이름은 중복되지 않게 입력해주세요."):(matchFormat=parseInt(document.getElementById("matchFormat").value),maxRounds=parseInt(document.getElementById("maxRounds").value),currentRound=1,allPairings=[],matchResults=[],matchHistory=new Map,initAudio(),stopTimer(),totalRounds.textContent=maxRounds,roundNum.textContent=currentRound,switchView(setupView,gameView),e=generatePairings(),allPairings.push(e),matchResults.push([]),renderPairings(e,currentRound-1))},document.getElementById("backBtn").onclick=()=>{stopTimer(),!1===resultView.classList.contains("hidden")?switchView(resultView,gameView):1===currentRound?switchView(gameView,setupView):(currentRound--,roundNum.textContent=currentRound,renderPairings(allPairings[currentRound-1],currentRound-1))},document.getElementById("nextRoundBtn").onclick=()=>{var t=[],n=allPairings[currentRound-1];for(let e=0;e<n.length;e++){var[,a]=n[e];if(a){var a=document.querySelector(`input[name='match${e}']:checked`),r=document.querySelector(`input[name='match${e}_b']:checked`);if(!a||!r)return alert("모든 경기 결과를 입력해주세요.");t.push([parseInt(a.value),parseInt(r.value)])}else t.push([matchFormat,0])}matchResults[currentRound-1]=t,currentRound++,roundNum.textContent=currentRound;var e=generatePairings();allPairings.push(e),matchResults.push([]),renderPairings(e,currentRound-1)},document.getElementById("viewResultBtn").onclick=()=>{var t=[],n=allPairings[currentRound-1];for(let e=0;e<n.length;e++){var[,a]=n[e];if(a){var a=document.querySelector(`input[name='match${e}']:checked`),r=document.querySelector(`input[name='match${e}_b']:checked`);if(!a||!r)return alert("모든 경기 결과를 입력해주세요.");t.push([parseInt(a.value),parseInt(r.value)])}else t.push([matchFormat,0])}matchResults[currentRound-1]=t,stopTimer(),switchView(gameView,resultView),renderFinalResults()},document.getElementById("resetBtn").onclick=()=>{stopTimer(),switchView(resultView,setupView)},document.getElementById("replayBtn").onclick=()=>{currentRound=1,allPairings=[],matchResults=[],matchHistory=new Map,totalRounds.textContent=maxRounds,roundNum.textContent=currentRound,switchView(resultView,gameView);var e=generatePairings();allPairings.push(e),matchResults.push([]),renderPairings(e,currentRound-1)}</script></body></html>