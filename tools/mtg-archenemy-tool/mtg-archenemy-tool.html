<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="color-scheme" content="light dark">
<title data-i18n-key="title">Archenemy Scheme Deck Helper</title>
<script>
    // Apply theme on initial load BEFORE tailwind script runs
    try {
        const savedMode = localStorage.getItem('darkMode');
        if (savedMode && JSON.parse(savedMode)) {
            document.documentElement.classList.add('dark');
        }
    } catch (e) { /* ignore */ }
</script>
<script>
  window.tailwind = window.tailwind || {};
  window.tailwind.config = {
    darkMode: 'class',
  }
</script>
<script src="https://cdn.tailwindcss.com"></script>
<script>
	window.i18n = {
		lang: localStorage.getItem('selectedLanguage') || 'ko',
		translations: {},
		initPromise: null,
		_resolveInit: null,
		init() {
			this.initPromise = new Promise(resolve => { this._resolveInit = resolve; });
			(async () => {
				try {
					const response = await fetch('../../assets/i18n/language.json');
					if (!response.ok) throw new Error('Network response was not ok');
					const data = await response.json();
					this.translations = data.translations;
					this.apply();
				} catch (error) {
					console.error('Failed to load translations:', error);
				} finally {
					this._resolveInit();
				}
			})();
		},
		t(key, replacements = {}) {
			const translation = this.translations['mtg-archenemy-tool']?.[key]?.[this.lang];
			if (!translation) return key;
			let result = translation;
			for (const placeholder in replacements) {
				result = result.replace(`{${placeholder}}`, replacements[placeholder]);
			}
			return result;
		},
		apply() {
			document.querySelectorAll('[data-i18n-key]').forEach(el => {
				el.textContent = this.t(el.dataset.i18nKey);
			});
			document.querySelectorAll('[data-i18n-key-placeholder]').forEach(el => {
				el.placeholder = this.t(el.dataset.i18nKeyPlaceholder);
			});
			document.querySelectorAll('[data-i18n-key-title]').forEach(el => {
				el.title = this.t(el.dataset.i18nKeyTitle);
			});
			document.querySelectorAll('[data-i18n-key-alt]').forEach(el => {
				el.alt = this.t(el.dataset.i18nKeyAlt);
			});
		}
	};
	window.i18n.init();
    // Theme listener for dynamic changes from parent window
    window.addEventListener('message', (event) => {
        if (event.data.theme) {
            if (event.data.theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
    });
</script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-200 font-sans">
<div class="container mx-auto p-4 max-w-4xl">
	<div class="header flex items-center gap-2 p-3 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl sticky top-0 z-10">
		<h1 class="text-lg font-bold" data-i18n-key="title">Archenemy Scheme Deck Helper</h1>
		<div class="flex-grow"></div>
		<button class="tab-btn px-3 py-2 text-sm rounded-lg" id="tabBuilder" data-i18n-key="tabBuilder">덱빌더</button>
		<button class="tab-btn px-3 py-2 text-sm rounded-lg" id="tabSim" data-i18n-key="tabSim">시뮬레이터</button>
		<select class="select bg-gray-200 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-sm" id="deckSlot">
			<option value="1" data-i18n-key="slot1">슬롯 1</option>
			<option value="2" data-i18n-key="slot2">슬롯 2</option>
			<option value="3" data-i18n-key="slot3">슬롯 3</option>
		</select>
	</div>

	<div class="grid grid-cols-1 gap-4 mt-4">
		<!-- Builder -->
		<div class="card bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl overflow-hidden" id="builderCard">
			<div class="title flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-700">
				<h2 class="text-base font-semibold" data-i18n-key="deckBuilderTitle">덱 빌더</h2>
				<div class="chips flex gap-2">
                    <span class="chip" id="deckStatus" data-i18n-key="deckStatus">0 / 0</span>
                    <span class="chip" id="slotInfo" data-i18n-key="slotInfo">슬롯 1</span>
                </div>
			</div>
			<div class="body p-3">
				<div class="controls flex flex-wrap gap-2 items-center mb-3">
					<input class="input" id="deckName" data-i18n-key-placeholder="deckNamePlaceholder" placeholder="덱 이름" />
					<label class="small" data-i18n-key="maxSizeLabel">최대 장수</label>
					<input class="input w-24" id="maxSize" type="number" min="1" max="99" value="10" />
					<label class="small" data-i18n-key="maxCopiesLabel">동일 카드 최대</label>
					<select id="maxCopies" class="input">
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="3">3</option>
						<option value="4">4</option>
					</select>
					<input class="input flex-1" id="search" data-i18n-key-placeholder="searchPlaceholder" placeholder="카드 검색" />
				</div>

				<div class="builder-rows flex flex-col gap-3">
					<div class="section">
						<div class="head">
							<div class="title" data-i18n-key="schemeListTitle">스킴 목록 (탭=미리보기 / + - = 추가·제거)</div>
							<button class="btn" id="toggleList" data-i18n-key="toggleListCollapse">접기</button>
						</div>
						<div class="content list" id="schemeList"></div>
					</div>

					<div class="section">
						<div class="head">
							<div class="title" data-i18n-key="currentDeckTitle">현재 덱</div>
							<div class="flex gap-2">
								<button class="btn success" id="saveDeck" data-i18n-key="saveButton">저장</button>
								<button class="btn" id="loadDeck" data-i18n-key="loadButton">불러오기</button>
								<button class="btn danger" id="clearDeck" data-i18n-key="clearButton">초기화</button>
							</div>
						</div>
						<div class="content list" id="deckList"></div>
					</div>
				</div>
			</div>
		</div>

		<!-- Simulator -->
		<div class="card bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl overflow-hidden" id="simCard" style="display:none">
			<div class="title flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-700">
				<h2 class="text-base font-semibold" data-i18n-key="simulatorTitle">시뮬레이션</h2>
				<div class="chips"><span class="chip" id="simSummary" data-i18n-key="simSummary">남은 0 / 전체 0 · 버린 0</span></div>
			</div>
			<div class="body p-3">
				<div class="controls flex flex-wrap gap-2 items-center mb-3">
					<button class="btn primary" id="startSim" data-i18n-key="startButton">시작</button>
					<button class="btn" id="nextScheme" disabled data-i18n-key="nextSchemeButton">다음 스킴</button>
					<button class="btn" id="resetSim" disabled data-i18n-key="resetSimButton">초기화</button>
				</div>

				<div class="sim-output grid grid-cols-1 gap-3">
					<div class="revealed bg-gray-100 dark:bg-gray-700 border-dashed border border-gray-300 dark:border-gray-600 rounded-lg p-3">
						<h3 class="font-semibold mb-2" data-i18n-key="revealedSchemeTitle">현재 공개된 스킴</h3>
						<div id="revealedName" class="small mb-2" data-i18n-key="noneRevealed">(없음)</div>
						<img id="revealedThumb" class="thumb max-w-40 max-h-56 rounded-md border border-gray-300 dark:border-gray-600 cursor-pointer block" style="display:none" alt="revealed">
						<div class="controls flex gap-2 mt-2">
							<button class="btn" id="markOngoing" disabled data-i18n-key="markOngoingButton">Ongoing으로 유지</button>
							<button class="btn" id="discardNow" disabled data-i18n-key="discardNowButton">버리기</button>
						</div>
					</div>
					<div class="zone flex gap-2 flex-wrap">
						<div class="min-w-[220px]">
							<div class="small" data-i18n-key="ongoingZoneTitle">Ongoing</div>
							<div id="ongoingZone" class="flex flex-col gap-1 mt-1"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Fullscreen Image Viewer -->
<div class="viewer fixed inset-0 hidden items-center justify-center bg-black/80 z-50" id="imgViewer" role="dialog" aria-modal="true">
	<img id="viewerImg" class="max-w-[92vw] max-h-[92vh] rounded-lg border border-gray-700" data-i18n-key-alt="cardImageAlt" alt="scheme full">
	<button class="close absolute top-4 right-4 text-2xl bg-gray-900 border border-gray-700 text-gray-200 rounded-lg px-3 py-1 cursor-pointer" id="closeViewer" data-i18n-key="closeViewerButton">닫기</button>
</div>

<style>
    /* Since the logic for tabs is simple, we use CSS for the active state */
    .tab-btn { @apply bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-200 border border-gray-300 dark:border-gray-500; }
    .tab-btn.active { @apply bg-blue-600 text-white border-blue-700; }
    .input, select.input { @apply bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-gray-200 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500; }
    .btn { @apply px-3 py-2 text-sm rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600; }
    .btn.primary { @apply bg-blue-600 text-white border-blue-700 hover:bg-blue-700; }
    .btn.success { @apply bg-green-600 text-white border-green-700 hover:bg-green-700; }
    .btn.danger { @apply bg-red-600 text-white border-red-700 hover:bg-red-700; }
    .small { @apply text-xs text-gray-500 dark:text-gray-400; }
    .chip { @apply bg-gray-200 dark:bg-gray-600 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded-full border border-gray-300 dark:border-gray-500; }
    .section { @apply bg-gray-100 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg; }
    .section .head { @apply flex items-center justify-between gap-2 p-2 border-b border-white/5 dark:border-white/10; }
    .section .title { @apply text-sm text-blue-800 dark:text-blue-300; }
    .section .content { @apply max-h-[420px] overflow-auto; }
    .list .row { @apply flex items-center justify-between gap-2 px-2 py-1 border-b border-white/5 dark:border-white/10; }
    .list .row:last-child { @apply border-b-0; }
    .row .name { @apply text-sm text-gray-800 dark:text-gray-100 cursor-pointer; }
    .row .actions { @apply flex items-center gap-1; }
    .count { @apply min-w-[28px] text-center font-mono; }
</style>
<script>
// ... (rest of the script)
</script>
</body>
</html>

