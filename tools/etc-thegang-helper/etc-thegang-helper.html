<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>더 갱 툴</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<style>
		body {
			background-color: #121212;
			color: #ffffff;
			font-family: 'Segoe UI', sans-serif;
			padding: 2rem;
		}
		.card-grid {
			display: flex;
			flex-wrap: wrap;
			gap: 1rem;
		}
		.card-box {
			background-color: #1e1e1e;
			border: 1px solid #444;
			border-radius: 0.5rem;
			padding: 0.5rem 1rem;
			cursor: pointer;
			position: relative;
		}
		.card-box .remove {
			position: absolute;
			top: 4px;
			right: 6px;
			cursor: pointer;
			color: #bbb;
		}
		.modal-body pre {
			white-space: pre-wrap;
			color: #ddd;
		}
	</style>
</head>
<body>
	<h2 class="mb-4">🎴 더 갱 툴</h2>

	<div class="mb-3">
		<label class="form-label">점수 모드:</label>
		<select class="form-select" id="scoreMode" onchange="toggleScoreMode()">
			<option value="counter">금고/경보 (3장)</option>
			<option value="points">점수제 (+1 / -1)</option>
		</select>
	</div>

	<div id="counterMode">
		<p>금고: <span id="safeCount">0</span> / 3</p>
		<p>경보: <span id="alarmCount">0</span> / 3</p>
		<button class="btn btn-success" onclick="addCount('safe')">금고 +1</button>
		<button class="btn btn-danger" onclick="addCount('alarm')">경보 +1</button>
	</div>
	<div id="pointsMode" style="display: none;">
		<p>점수: <span id="score">0</span></p>
		<button class="btn btn-primary" onclick="changeScore(1)">+1</button>
		<button class="btn btn-warning" onclick="changeScore(-1)">-1</button>
	</div>

	<hr>
	<h4>🛠️ 패널티 카드</h4>
	<div class="mb-2">
		<select id="penaltySelect" class="form-select"></select>
		<button class="btn btn-outline-light mt-2" onclick="addCard('penalty', false)">➕ 수동 추가</button>
		<button class="btn btn-outline-secondary mt-1" onclick="addCard('penalty', true)">🎲 랜덤 추가</button>
	</div>
	<div class="card-grid" id="penaltyCards"></div>

	<hr>
	<h4>🛠️ 어드밴티지 카드</h4>
	<div class="mb-2">
		<select id="advantageSelect" class="form-select"></select>
		<button class="btn btn-outline-light mt-2" onclick="addCard('advantage', false)">➕ 수동 추가</button>
		<button class="btn btn-outline-secondary mt-1" onclick="addCard('advantage', true)">🎲 랜덤 추가</button>
	</div>
	<div class="card-grid" id="advantageCards"></div>

	<hr>
	<button class="btn btn-danger" onclick="resetAll()">초기화</button>
	<button class="btn btn-light ms-2" onclick="showAllDescriptions()">📘 전체 설명 보기</button>

	<!-- Modal -->
	<div class="modal fade" id="descModal" tabindex="-1">
		<div class="modal-dialog modal-lg">
			<div class="modal-content bg-dark text-white">
				<div class="modal-header">
					<h5 class="modal-title">카드 설명</h5>
					<button type="button" class="btn-close btn-close-white" onclick="closeModalSafely()"></button>
				</div>
				<div class="modal-body">
					<pre id="descContent"></pre>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		const cards = {
			penalty: [
				["빠른 진입", "포켓 카드를 나눠 받은 후 즉시: 하얀색 칩을 가져가지 않습니다! 즉시 2라운드로 넘어가 커뮤니티 카드 3장을 공개합니다."],
				["소음 경보기", "포켓 카드를 나눠 받은 후 즉시: 1, 2, 3라운드에 사용하는 별 1개짜리 칩을 어두운 면으로 뒤집습니다. 누군가 이런 어두운 면인 칩을 탁자 가운데에서 가져가면, 이제 그 칩은 소유자를 바꿀 수 없습니다."],
				["동작 감지기", "2라운드에 공개된 커뮤니티 카드 중에 J, Q, K가 1장이라도 있다면: 1라운드에 별 1개짜리 하얀색 칩을 가져온 사람은 반드시 자기 포켓 카드를 전부 카드 더미 옆에 뒷면으로 버린 다음, 카드 더미에서 새 포켓 카드들을 가져옵니다."],
				["홍채 인식기", "가장 별이 많은 빨간색 칩을 가져온 사람이 쇼다운 때 자기 조합을 공개하기 전: 나머지 사람들은 함께 논의하여 그 사람의 포켓 카드 중 1장의 가치(2부터 A까지)를 맞혀야 합니다. 틀렸다면, 이번 작전은 실패합니다."],
				["급박한 도주", "3라운드에 주황색 칩을 가져오지 않습니다! 2라운드를 종료한 후, 네 번째 커뮤니티 카드를 공개하고 곧바로 4라운드로 넘어가세요."],
				["환풍구", "포켓 카드를 나눠 받은 후 즉시: 1, 2, 3라운드에 사용하는 가장 별이 많은 칩을 어두운 면으로 뒤집습니다. 누군가 이렇게 어두운 면인 칩을 탁자 가운데에서 가져가면, 이제 그 칩은 소유자를 바꿀 수 없습니다."],
				["레이저 경보기", "2라운드에 공개된 커뮤니티 카드 중에 J, Q, K가 1장도 없다면: 1라운드에 가장 별이 많은 하얀색 칩을 가져온 사람은 반드시 자기 포켓 카드들을 카드 더미 옆에 전부 뒷면으로 버린 다음, 카드 더미에서 새 포켓 카드들을 가져옵니다."],
				["정전", "각 라운드 시작할 때: 모든 사람은 직전 라운드에 가져온 자신의 칩을 버려야 합니다."],
				["지문 인식기", "가장 별이 많은 빨간색 칩을 가져온 사람이 쇼다운 때 자기 조합을 공개하기 전: 나머지 사람들은 함께 논의하여 그 사람의 조합(하이 카드부터 로열 스트레이트 플러시까지)을 맞혀야 합니다. 틀렸다면, 이번 작전은 실패합니다."],
				["보안 카메라", "포켓 카드를 나눠 받은 후 즉시: 각자 포켓 카드 1장을 추가로 나눠 받습니다. 이제 각자 포켓 카드 3장으로 게임을 진행합니다."]
			],
			advantage: [
				["정보원", "여러분 중 1명은 다른 1명에게 자기 포켓 카드 중 1장을 보여줍니다."],
				["도주 차량 운전수", "여러분 중 1명은 커뮤니티 카드와 자기 포켓 카드를 보고 현재 자기 조합이 무엇인지 모두에게 밝힙니다."],
				["투자자", "포켓 카드를 나눠 받은 후 즉시: 각자 자기 포켓 카드 중 '페이스 카드'(J, Q, K)가 몇 장 있는지 모두에게 밝힙니다."],
				["작전 기획자", "가치 하나를 정합니다(2부터 A까지). 여러분 중 1명은 자신이 그 가치인 카드를 몇 장 갖고 있는지 모두에게 밝힙니다."],
				["해커", "여러분 중 1명은 카드 더미에서 추가 포켓 카드 1장을 가져옵니다. 그런 다음, 자기 포켓 카드 중 1장을 골라 카드 더미 옆에 뒷면으로 버립니다."],
				["코디네이터", "포켓 카드를 나눠 받은 후 즉시: 각자 자기 포켓 카드 중 1장을 선택한 다음, 이를 모두 동시에 자신의 왼쪽 사람에게 넘깁니다."],
				["잭", "여러분 중 1명은 이 카드를 자기 포켓 카드로 가져옵니다. 그런 다음, 자기 포켓 카드 중 1장을 카드 더미 옆에 뒷면으로 버립니다. 잭은 무늬가 없는 J로 취급합니다."],
				["수학쟁이", "포켓 카드를 나눠 받은 후 즉시: 각자 자기 포켓 카드들의 숫자를 더한 값을 공개합니다. J, Q, K는 10, A는 11로 계산합니다."],
				["사기꾼", "포켓 카드를 나눠 받은 후 즉시: 각자 자기 카드를 확인한 뒤, 모든 사람의 포켓 카드를 모아서 뒷면으로 섞은 다음 다시 각자 나눠 받습니다."],
				["어깨", "쇼다운 때, 이 카드를 가진 사람은 같은 조합이라면 항상 더 강한 것으로 간주됩니다."]
			]
		};

		const state = { penalty: [], advantage: [], score: 0, safe: 0, alarm: 0 };
		const modalInstance = new bootstrap.Modal(document.getElementById("descModal"));

		function closeModalSafely() {
			if (modalInstance._isShown) {
				modalInstance.hide();
			}
		}

		function showAllDescriptions() {
			let text = "--- 패널티 카드 ---\n";
			cards.penalty.forEach((c, i) => text += `${i + 1}. ${c[0]}\n${c[1]}\n\n`);
			text += "--- 어드밴티지 카드 ---\n";
			cards.advantage.forEach((c, i) => text += `${i + 1}. ${c[0]}\n${c[1]}\n\n`);
			document.getElementById("descContent").textContent = text;
			modalInstance.show();
		}

		function toggleScoreMode() {
			document.getElementById("counterMode").style.display = scoreMode.value === "counter" ? "block" : "none";
			document.getElementById("pointsMode").style.display = scoreMode.value === "points" ? "block" : "none";
		}

		function populateSelects() {
			["penalty", "advantage"].forEach(type => {
				const select = document.getElementById(`${type}Select`);
				cards[type].forEach((c, i) => {
					const opt = document.createElement("option");
					opt.value = i;
					opt.textContent = `${i + 1}. ${c[0]}`;
					select.appendChild(opt);
				});
			});
		}

		function renderCards() {
			["penalty", "advantage"].forEach(type => {
				const container = document.getElementById(`${type}Cards`);
				container.innerHTML = "";
				state[type].forEach(i => {
					const div = document.createElement("div");
					div.className = "card-box";
					div.innerHTML = `<span class="remove" onclick="removeCard('${type}', ${i})">✖</span><strong>${i + 1}. ${cards[type][i][0]}</strong>`;
					div.onclick = () => showCard(type, i);
					container.appendChild(div);
				});
			});
		}

		function addCard(type, random = false) {
			const index = random ? getRandomCard(type) : parseInt(document.getElementById(`${type}Select`).value);
			if (!state[type].includes(index)) {
				state[type].push(index);
				renderCards();
			}
		}

		function removeCard(type, index) {
			state[type] = state[type].filter(i => i !== index);
			renderCards();
		}

		function getRandomCard(type) {
			const candidates = cards[type].map((_, i) => i).filter(i => !state[type].includes(i));
			return candidates.length ? candidates[Math.floor(Math.random() * candidates.length)] : -1;
		}

		function showCard(type, index) {
			document.getElementById("descContent").textContent = `${index + 1}. ${cards[type][index][0]}\n\n${cards[type][index][1]}`;
			modalInstance.show();
		}

		function resetAll() {
			state.penalty = [];
			state.advantage = [];
			state.score = 0;
			state.safe = 0;
			state.alarm = 0;
			document.getElementById("score").textContent = 0;
			document.getElementById("safeCount").textContent = 0;
			document.getElementById("alarmCount").textContent = 0;
			renderCards();
		}

		function changeScore(val) {
			state.score += val;
			document.getElementById("score").textContent = state.score;
		}

		function addCount(which) {
			if (which === "safe" && state.safe < 3) state.safe++;
			if (which === "alarm" && state.alarm < 3) state.alarm++;
			document.getElementById("safeCount").textContent = state.safe;
			document.getElementById("alarmCount").textContent = state.alarm;
		}

		populateSelects();
		renderCards();
	</script>
</body>
</html>
