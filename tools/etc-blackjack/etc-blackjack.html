<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title data-i18n-key="title">ì˜¤ëŠ˜ì˜ ìš´ì„¸ - ë¸”ë™ì­</title>
    <script>
        // Apply theme on initial load BEFORE tailwind script runs
        try {
            const savedMode = localStorage.getItem('darkMode');
            if (savedMode && JSON.parse(savedMode)) {
                document.documentElement.classList.add('dark');
            }
        } catch (e) { /* ignore */ }
    </script>
    <script>
      window.tailwind = window.tailwind || {};
      window.tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                fontFamily: {
                    'gowun': ['Gowun Dodum', 'sans-serif'],
                },
            },
        },
      }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <script>
        window.i18n = {
            lang: localStorage.getItem('selectedLanguage') || 'ko',
            translations: {},
            initPromise: null,
            _resolveInit: null,
            init() {
                this.initPromise = new Promise(resolve => { this._resolveInit = resolve; });
                (async () => {
                    try {
                        const response = await fetch('../../assets/i18n/language.json');
                        if (!response.ok) throw new Error('Network response was not ok');
                        const data = await response.json();
                        this.translations = data.translations;
                        this.apply();
                    } catch (error) {
                        console.error('Failed to load translations:', error);
                    } finally {
                        this._resolveInit();
                    }
                })();
            },
            t(key, replacements = {}) {
                const translation = this.translations['etc-blackjack']?.[key]?.[this.lang];
                if (!translation) return key;
                let result = translation;
                for (const placeholder in replacements) {
                    result = result.replace(`{${placeholder}}`, replacements[placeholder]);
                }
                return result;
            },
            apply() {
                document.querySelectorAll('[data-i18n-key]').forEach(el => {
                    el.textContent = this.t(el.dataset.i18nKey);
                });
            }
        };
        window.i18n.init();
        // Theme listener for dynamic changes from parent window
        window.addEventListener('message', (event) => {
            if (event.data.theme) {
                if (event.data.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }
        });
    </script>
    <style>
        .card { transform-style: preserve-3d; }
        .card.is-flipped { transform: rotateY(0deg); }
        .card .back { transform: rotateY(180deg); }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 flex justify-center items-center min-h-screen p-2 box-border font-gowun">
    <div class="game-table w-full max-w-3xl text-white text-center bg-green-800 p-8 rounded-[150px] border-[15px] border-yellow-800 shadow-2xl">
        <h1 class="text-4xl font-bold text-yellow-400 mb-5" data-i18n-key="blackjackTitle">ğŸƒ ë¸”ë™ì­ ğŸƒ</h1>
        
        <div class="hand-area min-h-[140px] my-5" id="dealer-area">
            <h2 class="text-2xl font-bold text-gray-300 mb-3" data-i18n-key="dealer">ë”œëŸ¬ (<span id="dealer-score" class="score"><span data-i18n-key="score">ì ìˆ˜:</span> 0</span>)</h2>
            <div class="cards flex justify-center items-center flex-wrap min-h-[120px]" id="dealer-cards"></div>
        </div>
        
        <div class="message-area text-2xl font-bold min-h-[50px] my-5 text-yellow-400" id="message"></div>

        <div class="hand-area min-h-[140px] my-5" id="player-area">
            <h2 class="text-2xl font-bold text-gray-300 mb-3" data-i18n-key="player">í”Œë ˆì´ì–´ (<span id="player-score" class="score"><span data-i18n-key="score">ì ìˆ˜:</span> 0</span>)</h2>
            <div class="cards flex justify-center items-center flex-wrap min-h-[120px]" id="player-cards"></div>
        </div>

        <div class="btn-container mt-5">
            <button id="startBtn" class="btn bg-green-600 hover:bg-green-500" data-i18n-key="newGame">ìƒˆ ê²Œì„</button>
            <button id="hitBtn" class="btn bg-blue-600 hover:bg-blue-500" disabled data-i18n-key="hit">Hit</button>
            <button id="standBtn" class="btn bg-red-600 hover:bg-red-500" disabled data-i18n-key="stand">Stand</button>
        </div>
    </div>
    <style>
        .score { @apply font-bold text-white bg-black/30 px-3 py-1 rounded-md inline-block min-w-[120px]; }
        .btn { @apply text-white font-bold py-3 px-6 rounded-md text-lg shadow-md transition transform hover:-translate-y-1 disabled:bg-gray-500 disabled:cursor-not-allowed disabled:transform-none; }
    </style>
    <script src="js/main.js"></script>
</body>
</html>