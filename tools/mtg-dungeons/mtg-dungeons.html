<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta name="color-scheme" content="light dark" />
	<title data-i18n-key="title">MTG 던전 뷰어</title>
    <script>
        // Apply theme on initial load BEFORE tailwind script runs
        try {
            const savedMode = localStorage.getItem('darkMode');
            if (savedMode && JSON.parse(savedMode)) {
                document.documentElement.classList.add('dark');
            }
        } catch (e) { /* ignore */ }
    </script>
    <script>
      window.tailwind = window.tailwind || {};
      window.tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
	<script>
		window.i18n = {
			lang: localStorage.getItem('selectedLanguage') || 'ko',
			translations: {},
			initPromise: null,
			_resolveInit: null,
			init() {
				this.initPromise = new Promise(resolve => { this._resolveInit = resolve; });
				(async () => {
					try {
						const response = await fetch('../../assets/i18n/language.json');
						if (!response.ok) throw new Error('Network response was not ok');
						const data = await response.json();
						this.translations = data.translations;
						this.apply();
					} catch (error) {
						console.error('Failed to load translations:', error);
					} finally {
						this._resolveInit();
					}
				})();
			},
			t(key, replacements = {}) {
				const translation = this.translations['mtg-dungeons']?.[key]?.[this.lang];
				if (!translation) return key;
				let result = translation;
				for (const placeholder in replacements) {
					result = result.replace(`{${placeholder}}`, replacements[placeholder]);
				}
				return result;
			},
			apply() {
				document.querySelectorAll('[data-i18n-key]').forEach(el => {
					el.textContent = this.t(el.dataset.i18nKey);
				});
			}
		};
		window.i18n.init();
        // Theme listener for dynamic changes from parent window
        window.addEventListener('message', (event) => {
            if (event.data.theme) {
                if (event.data.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }
        });
	</script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-200 font-sans grid grid-rows-[auto_auto_1fr_auto] gap-4 place-items-center m-4">
	<div class="text-center">
		<h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100" data-i18n-key="title">MTG 기타카드 뷰어</h1>
		<div class="text-sm text-gray-600 dark:text-gray-400" data-i18n-key="subtitle">카드 이미지 다운로드에 데이터가 사용됩니다.</div>
	</div>

	<!-- 1행 UI -->
	<div class="toolbar w-full max-w-6xl p-3 grid grid-cols-[auto_auto_1fr_minmax(160px,_320px)_minmax(200px,_420px)] md:grid-cols-1 md:grid-rows-auto items-center gap-3 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl" id="toolbar">
		<label class="inline-flex items-center gap-2 text-sm font-bold text-gray-700 dark:text-gray-300 whitespace-nowrap">
            <input type="checkbox" id="cb-enable" class="form-checkbox rounded" />
            <span data-i18n-key="dataUsageAgree">데이터 사용 동의</span>
        </label>
		<div class="font-extrabold text-gray-800 dark:text-gray-100 text-base whitespace-nowrap" id="titleLeft">MTG - Dungeon</div>
		<div class="w-full"></div>
		<select id="select-category" aria-label="카테고리 선택" data-i18n-key-aria-label="categorySelect" class="p-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 outline-none disabled:opacity-50 disabled:cursor-not-allowed w-full md:col-span-full"></select>
		<select id="select-item" aria-label="카드 선택" data-i18n-key-aria-label="cardSelect" class="p-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 outline-none disabled:opacity-50 disabled:cursor-not-allowed w-full md:col-span-full"></select>
	</div>

	<!-- 프리뷰 -->
	<div class="viewer w-full max-w-6xl p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl shadow-lg">
		<div class="viewer-header flex items-baseline justify-between gap-2 mb-3">
			<div class="viewer-title text-base font-bold text-gray-800 dark:text-gray-100" id="viewerTitle"><span data-i18n-key="categoryLabel">카테고리:</span> -</div>
			<div class="viewer-sub text-sm text-gray-500 dark:text-gray-400" id="viewerSub"><span data-i18n-key="selectionLabel">선택:</span> -</div>
		</div>
		<div class="viewer-frame relative w-full rounded-lg border-dashed border border-gray-300 dark:border-gray-600 flex items-center justify-center overflow-hidden" id="viewerFrame" style="background: repeating-conic-gradient(from 0deg, #FAFAFA 0% 25%, #F5F5F5 25% 50%) 50% 50% / 16px 16px;">
			<img id="previewImage" src="" alt="선택한 카드/시트 이미지가 여기에 표시됩니다." data-i18n-key-alt="placeholderImageAlt" class="block max-w-full max-h-full object-contain cursor-zoom-in">
		</div>
	</div>

	<footer class="text-xs text-gray-500 dark:text-gray-400 mt-1"><p data-i18n-key="imageSource">이미지 출처: magiccards.info</p></footer>

	<div id="fsOverlay" class="fullscreen-overlay fixed inset-0 hidden items-center justify-center bg-black/90 z-50 touch-pinch-zoom" aria-hidden="true" role="dialog" aria-label="카드 전체보기" data-i18n-key-aria-label="fullscreenImageAlt">
		<img id="fsImage" class="fullscreen-img max-w-[98vw] max-h-[98vh] object-contain rounded-lg shadow-2xl cursor-zoom-out" alt="">
	</div>
    <script src="js/main.js"></script>
</body>
</html>
