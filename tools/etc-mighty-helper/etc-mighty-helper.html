<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="title">ë§ˆì´í‹° ë³´ì¡° íˆ´</title>
    <script>
        // This script needs to run before Tailwind to prevent FOUC (Flash of Unstyled Content)
        const applyTheme = (theme) => {
            const indicator = document.getElementById('theme-indicator');
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                if(indicator) indicator.textContent = '(ë‹¤í¬)';
            } else {
                document.documentElement.classList.remove('dark');
                if(indicator) indicator.textContent = '(ë¼ì´íŠ¸)';
            }
        };
        try {
            const savedMode = localStorage.getItem('darkMode');
            applyTheme(savedMode && JSON.parse(savedMode) ? 'dark' : 'light');
        } catch (e) {
            applyTheme('light'); // Default to light on error
        }
    </script>
    <script>
        window.i18n = {
            lang: localStorage.getItem('selectedLanguage') || 'ko',
            translations: {},
            initPromise: null,
            _resolveInit: null,
            init() {
                this.initPromise = new Promise(resolve => { this._resolveInit = resolve; });
                (async () => {
                    try {
                        const response = await fetch('../../assets/i18n/language.json');
                        if (!response.ok) throw new Error('Network response was not ok');
                        const data = await response.json();
                        this.translations = data.translations;
                        this.apply();
                    } catch (error) {
                        console.error('Failed to load translations:', error);
                    } finally {
                        this._resolveInit();
                    }
                })();
            },
            t(key, replacements = {}) {
                const translation = this.translations['etc-mighty-helper']?.[key]?.[this.lang];
                if (!translation) return key;
                let result = translation;
                for (const placeholder in replacements) {
                    result = result.replace(`{${placeholder}}`, replacements[placeholder]);
                }
                return result;
            },
            apply() {
                document.querySelectorAll('[data-i18n-key]').forEach(el => {
                    el.textContent = this.t(el.dataset.i18nKey);
                });
                // Re-apply theme here to make sure indicator is updated after i18n
                 try {
                    const savedMode = localStorage.getItem('darkMode');
                    applyTheme(savedMode && JSON.parse(savedMode) ? 'dark' : 'light');
                } catch (e) {
                    applyTheme('light'); // Default to light on error
                }
            }
        };
        window.i18n.init();

        // Theme listener for dynamic changes from parent window
        window.addEventListener('message', (event) => {
            if (event.data.theme) {
                applyTheme(event.data.theme);
            }
        });
    </script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-sans p-6">
    <div class="max-w-2xl mx-auto">
            <div class="flex items-center gap-2 mb-4">
        <h2 class="text-2xl font-bold" data-i18n-key="title">ğŸƒ ë§ˆì´í‹° ë³´ì¡° íˆ´</h2>
        <span id="theme-indicator" class="text-base"></span>
    </div>
        <details class="mb-4">
            <summary class="cursor-pointer text-gray-600 dark:text-gray-400" data-i18n-key="rulesSummary">ë§ˆì´í‹° ê·œì¹™ ìš”ì•½ ë³´ê¸°</summary>
            <ul class="list-disc list-inside mt-2 text-sm text-gray-700 dark:text-gray-300">
                <li data-i18n-key="rule1">ë§ˆì´í‹°: ë³´í†µ ìŠ¤í˜ì´ë“œ A (ë‹¨, ìŠ¤í˜ì´ë“œ ê¸°ë£¨ ì‹œ ë‹¤ì´ì•„ A)</li>
                <li data-i18n-key="rule2">ì¡°ì»¤ì½œ: ë³´í†µ í´ë¡œë²„ 3 (ë‹¨, í´ë¡œë²„ ê¸°ë£¨ ì‹œ ìŠ¤í˜ì´ë“œ 3)</li>
                <li data-i18n-key="rule3">20 ê³µì•½ ì‹œ: í’€ (x1.5)</li>
                <li data-i18n-key="rule4">ë¬¸ì–‘ ì—†ìŒ ì„ íƒ ì‹œ: ë…¸ê¸°ë£¨ (x2)</li>
            </ul>
        </details>
        <div class="mb-4">
            <label for="bidNumber" class="block mb-2 font-medium" data-i18n-key="bidLabel">ê³µì•½ (ìˆ«ì):</label>
            <select id="bidNumber" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                <option value="13">13</option>
                <option value="14">14</option>
                <option value="15">15</option>
                <option value="16">16</option>
                <option value="17">17</option>
                <option value="18">18</option>
                <option value="19">19</option>
                <option value="20">20</option>
            </select>
        </div>
        <div class="mb-4">
            <label for="suitSelect" class="block mb-2 font-medium" data-i18n-key="suitLabel">ê¸°ë£¨ ë¬¸ì–‘ ì„ íƒ:</label>
            <select id="suitSelect" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200">
                <option value="none" data-i18n-key="noSuit">ğŸš« ë¬¸ì–‘ ì—†ìŒ (ë…¸ê¸°ë£¨)</option>
                <option value="spade" data-i18n-key="spade">â™  ìŠ¤í˜ì´ë“œ</option>
                <option value="heart" data-i18n-key="heart">â™¥ í•˜íŠ¸</option>
                <option value="diamond" data-i18n-key="diamond">â™¦ ë‹¤ì´ì•„</option>
                <option value="club" data-i18n-key="club">â™£ í´ë¡œë²„</option>
            </select>
        </div>
        <button class="w-full bg-blue-500 hover:bg-blue-700 dark:bg-indigo-500 dark:hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded mb-4" onclick="calculateMighty()" data-i18n-key="viewResults">ê²°ê³¼ ë³´ê¸°</button>
        <div id="result" class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow"></div>
    </div>
    <script src="js/main.js"></script>
</body>
</html>
