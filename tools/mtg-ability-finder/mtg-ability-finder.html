<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n-key="title">MTG Ability Finder</title>
    <script>
        // Apply theme on initial load BEFORE tailwind script runs
        try {
            const savedMode = localStorage.getItem('darkMode');
            if (savedMode && JSON.parse(savedMode)) {
                document.documentElement.classList.add('dark');
            }
        } catch (e) { /* ignore */ }
    </script>
    <script>
      window.tailwind = window.tailwind || {};
      window.tailwind.config = {
        darkMode: 'class',
      }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        window.i18n = {
            lang: localStorage.getItem('selectedLanguage') || 'ko',
            translations: {},
            initPromise: null,
            _resolveInit: null,
            init() {
                this.initPromise = new Promise(resolve => { this._resolveInit = resolve; });
                (async () => {
                    try {
                        const response = await fetch('../../assets/i18n/language.json');
                        if (!response.ok) throw new Error('Network response was not ok');
                        const data = await response.json();
                        this.translations = data.translations;
                        this.apply();
                    } catch (error) {
                        console.error('Failed to load translations:', error);
                    } finally {
                        this._resolveInit();
                    }
                })();
            },
            t(key, replacements = {}) {
                const translation = this.translations['mtg-ability-finder']?.[key]?.[this.lang];
                if (!translation) return key;
                let result = translation;
                for (const placeholder in replacements) {
                    result = result.replace(`{${placeholder}}`, replacements[placeholder]);
                }
                return result;
            },
            apply() {
                document.querySelectorAll('[data-i18n-key]').forEach(el => {
                    el.textContent = this.t(el.dataset.i18nKey);
                });
                document.querySelectorAll('[data-i18n-key-placeholder]').forEach(el => {
                    el.placeholder = this.t(el.dataset.i18nKeyPlaceholder);
                });
                document.querySelectorAll('[data-i18n-key-title]').forEach(el => {
                    el.title = this.t(el.dataset.i18nKeyTitle);
                });
                document.querySelectorAll('[data-i18n-key-alt]').forEach(el => {
                    el.alt = this.t(el.dataset.i18nKeyAlt);
                });
            }
        };
        window.i18n.init();

        // Theme listener for dynamic changes from parent window
        window.addEventListener('message', (event) => {
            if (event.data.theme) {
                if (event.data.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }
        });
    </script>
</head>
<body class="flex flex-col h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 font-sans">
    <div id="searchSection" class="relative p-2 flex-shrink-0">
        <input type="text" id="abilityInput" class="w-full max-w-lg mx-auto block text-2xl p-4 h-16 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-blue-500" data-i18n-key-placeholder="abilityInputPlaceholder" placeholder="Enter MTG ability keyword" oninput="filterAbilities()" autocomplete="off">
        <div id="lastUpdateBar" class="text-center mt-2 text-sm text-gray-500 dark:text-gray-400" data-i18n-key="lastUpdatedPrefix">last updated : <span id="lastUpdateText" data-i18n-key="lastUpdatedDefault">SPM-2025-09-26</span></div>
    </div>

    <div id="scrollableContent" class="flex-grow overflow-y-auto px-4 pb-4">
        <div id="divider" class="my-4 border-b border-gray-300 dark:border-gray-700"></div>
        <div id="abilityList" class="flex flex-wrap gap-2 justify-center"></div>

        <div id="abilityDetails" class="hidden mt-8 text-center pb-5">
            <h2 id="selectedAbility" class="text-3xl font-bold"></h2>
            <p id="abilityText" class="mt-3 text-lg"></p>
            <button class="mt-6 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700" id="resetBtn" onclick="resetView()" data-i18n-key="backToListButton">üîÅ Back to List</button>
        </div>
    </div>
    <script src="js/main.js"></script>
</body>
</html>