const ResourceManager={basePath:"",dungeon(filename){return`${this.basePath}/assets/dungeon/${filename}`}};window.session_data={};window.resourceManager=ResourceManager;const toolIndexUrl="tool_index.json";const toolListContainer=document.getElementById("tool-list-container");const contentArea=document.getElementById("content");const loaderOverlay=document.getElementById("loader-overlay");const modalToolOverlay=document.getElementById("modal-tool-overlay");const modalTool=document.getElementById("modal-tool-iframe");const sidebar=document.getElementById("sidebar");const sidebarOverlay=document.getElementById("sidebar-overlay");const toggleSidebarBtn=document.getElementById("toggleSidebarBtn");const fixedButtonsContainer=document.getElementById("fixed-buttons-container");const uiToggleBtn=document.getElementById("uiToggleBtn");const expandedUiContainer=document.getElementById("expanded-ui-container");const hideButtonsBtn=document.getElementById("hideButtonsBtn");const fullscreenBtn=document.getElementById("fullscreenBtn");let currentOpenModalUrl=null;const modalToolDisplayNameMap={};const isMobile=/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);history.replaceState({modal:false},"",location.href);toggleSidebar(true);if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){document.body.classList.add("iOS")}function toggleSidebar(show){if(show){sidebar.classList.add("show");sidebarOverlay.classList.add("active")}else{sidebar.classList.remove("show");sidebarOverlay.classList.remove("active")}}function toggleUiExpansion(forceHide=false){const isActive=expandedUiContainer.classList.contains("show");if(forceHide||isActive){expandedUiContainer.classList.remove("show");uiToggleBtn.classList.remove("active")}else{expandedUiContainer.classList.add("show");uiToggleBtn.classList.add("active")}}function getIconForTool(tool){if(tool.tags?.includes("mtg"))return"bi-box-seam";if(tool.tags?.includes("csv"))return"bi-file-earmark-spreadsheet";if(tool.tags?.includes("json"))return"bi-file-earmark-code";if(tool.type==="html"||Array.isArray(tool.type)&&tool.type.includes("html"))return"bi-file-earmark-play";return"bi-tools"}function renderEmbeddedTool(tool){loaderOverlay.style.display="flex";if(modalToolOverlay.style.display==="flex"){closeModalTool(false)}let html="";if(tool.hide_header!==true){html+=`<h1 class="display-5 text-light mb-4">${tool.name}</h1>`}let isIframe=false;if(tool.type==="html"||Array.isArray(tool.type)&&tool.type.includes("html")){const htmlPath=`${tool.path}${tool.name}.html`;html+=`<iframe id="embedded-tool-iframe" src="${htmlPath}" class="w-100" style="height: 100%; border: none; border-radius: 8px;"></iframe>`;isIframe=true}else{}contentArea.innerHTML=html;toggleSidebar(false);if(isIframe){const embeddedToolIframe=document.getElementById("embedded-tool-iframe");const iframeWindow=embeddedToolIframe.contentWindow;embeddedToolIframe.onload=()=>{loaderOverlay.style.display="none";if(iframeWindow&&typeof iframeWindow.onEmbeddedOpen==="function"){iframeWindow.onEmbeddedOpen()}};setTimeout(()=>{if(loaderOverlay.style.display==="flex"){loaderOverlay.style.display="none"}},8e3)}else{loaderOverlay.style.display="none"}setTimeout(()=>window.scrollTo(0,0),10)}function openModalTool(fullUrl,tool){if(modalToolOverlay.style.display==="flex"&&currentOpenModalUrl===fullUrl){closeModalTool();return}loaderOverlay.style.display="flex";modalTool.onload=()=>{loaderOverlay.style.display="none";modalToolOverlay.style.display="flex";try{const iframeWindow=modalTool.contentWindow;if(iframeWindow&&typeof iframeWindow.onModalOpen==="function"){iframeWindow.onModalOpen()}}catch(e){console.error("Iframe 접근 오류:",e)}};toggleSidebar(false);toggleSidebarBtn.classList.add("inactive-when-modal");document.body.classList.add("modal-open");currentOpenModalUrl=fullUrl;updateModalToolButtonStates(fullUrl);if(!history.state?.modal){history.pushState({modal:true},"","")}modalTool.src=fullUrl}function closeModalTool(pushStateBack=true){modalTool.onload=null;try{const iframeWindow=modalTool.contentWindow;if(iframeWindow&&typeof iframeWindow.onModalClose==="function"){iframeWindow.onModalClose()}}catch(e){console.error("Iframe 접근 오류:",e)}toggleSidebarBtn.classList.remove("inactive-when-modal");modalToolOverlay.style.display="none";document.body.classList.remove("modal-open");modalTool.src="about:blank";clearActiveModalToolButtonState();currentOpenModalUrl=null;if(pushStateBack&&history.state?.modal){history.back()}}function clearActiveListSelection(){const currentActive=document.querySelector(".nav-link.active-tool");if(currentActive)currentActive.classList.remove("active-tool")}function clearActiveModalToolButtonState(){document.querySelectorAll(".modal-tool-button").forEach(btn=>{btn.classList.remove("active-modal");btn.textContent=modalToolDisplayNameMap[btn.dataset.modalUrl]})}function updateModalToolButtonStates(activeUrl){document.querySelectorAll(".modal-tool-button").forEach(btn=>{if(btn.dataset.modalUrl===activeUrl){btn.classList.add("active-modal");btn.textContent="✓"}else{btn.classList.remove("active-modal");btn.textContent=modalToolDisplayNameMap[btn.dataset.modalUrl]}})}function toggleFullScreen(){const isIOSDevice=document.body.classList.contains("iOS");const fullscreenIcon=fullscreenBtn.querySelector("i");if(isIOSDevice){const isPseudoFullscreen=document.body.classList.toggle("pseudo-fullscreen");fullscreenIcon.classList.toggle("bi-arrows-fullscreen",!isPseudoFullscreen);fullscreenIcon.classList.toggle("bi-arrows-angle-contract",isPseudoFullscreen)}else{if(!document.fullscreenElement){document.documentElement.requestFullscreen().catch(err=>{alert(`전체화면 모드를 시작할 수 없습니다: ${err.message}`)})}else{if(document.exitFullscreen)document.exitFullscreen()}}toggleUiExpansion(true)}uiToggleBtn.addEventListener("click",()=>toggleUiExpansion());hideButtonsBtn.addEventListener("click",()=>{const icon=hideButtonsBtn.querySelector("i");const isHidden=fixedButtonsContainer.classList.toggle("hidden-to-right");icon.classList.toggle("bi-box-arrow-right",!isHidden);icon.classList.toggle("bi-box-arrow-left",isHidden);toggleUiExpansion(true)});toggleSidebarBtn.addEventListener("click",()=>{if(toggleSidebarBtn.classList.contains("inactive-when-modal"))return;toggleUiExpansion(true);toggleSidebar(!sidebar.classList.contains("show"))});fullscreenBtn.addEventListener("click",toggleFullScreen);document.addEventListener("fullscreenchange",()=>{const isFullscreen=!!document.fullscreenElement;const fullscreenIcon=fullscreenBtn.querySelector("i");fullscreenIcon.classList.toggle("bi-arrows-fullscreen",!isFullscreen);fullscreenIcon.classList.toggle("bi-arrows-angle-contract",isFullscreen)});window.addEventListener("popstate",event=>{if(!event.state?.modal&&modalToolOverlay.style.display==="flex"){closeModalTool(false)}});contentArea.addEventListener("click",()=>{const h1=contentArea.querySelector("h1");if(h1&&h1.textContent==="툴을 선택해주세요"){toggleSidebar(true)}});fetch(toolIndexUrl).then(res=>res.json()).then(data=>{const enabledTools=data.tools.filter(tool=>{if(tool.enable===false)return false;if(tool.mobileOnly===true&&!isMobile)return false;if(tool.desktopOnly===true&&isMobile)return false;return true});const modalTools=enabledTools.filter(tool=>tool.type==="html_modal"||Array.isArray(tool.type)&&tool.type.includes("html_modal"));modalTools.forEach(tool=>{const fullUrl=`${tool.path}${tool.name}.html?modal=true`;const displayName=tool.modalIcon||tool.name;modalToolDisplayNameMap[fullUrl]=displayName;const button=document.createElement("button");button.className="btn modal-tool-button";button.textContent=displayName;button.dataset.modalUrl=fullUrl;button.title=tool.name;if(tool.modalIconColor){button.style.backgroundColor=tool.modalIconColor}button.onclick=()=>{toggleUiExpansion(true);openModalTool(fullUrl,tool)};fixedButtonsContainer.appendChild(button)});const toolsByParent=enabledTools.reduce((acc,tool)=>{const parent=tool.parent||"기타";if(!acc[parent])acc[parent]=[];acc[parent].push(tool);return acc},{});Object.keys(toolsByParent).forEach(parent=>{const parentLi=document.createElement("li");parentLi.className="nav-item";parentLi.innerHTML=`\n                    <a href="#collapse-${parent.replace(/\s/g,"")}" class="nav-link link-dark" data-bs-toggle="collapse" aria-expanded="true">\n                        <i class="bi bi-folder me-2"></i>${parent}\n                        <span class="ms-auto flex-shrink-0"><i class="bi bi-chevron-down collapse-icon"></i></span>\n                    </a>\n                `;const subUl=document.createElement("ul");subUl.id=`collapse-${parent.replace(/\s/g,"")}`;subUl.className="nav nav-pills flex-column ms-3 collapse show";toolsByParent[parent].forEach(tool=>{const item=document.createElement("li");item.className="nav-item";const link=document.createElement("a");link.href="#";link.className="nav-link link-dark";link.innerHTML=`<i class="bi ${getIconForTool(tool)} me-2"></i>${tool.name}`;link.onclick=e=>{e.preventDefault();clearActiveModalToolButtonState();clearActiveListSelection();link.classList.add("active-tool");renderEmbeddedTool(tool)};item.appendChild(link);subUl.appendChild(item)});if(toolsByParent[parent].length>0){parentLi.appendChild(subUl);toolListContainer.appendChild(parentLi)}})});document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){console.log("Index: App is visible again. Forcing reflow and soft-resetting input.");requestAnimationFrame(()=>{document.body.offsetHeight;document.body.click()})}});window.addEventListener("pageshow",()=>{console.log("Index: Page is shown again. Resetting main overlays.");document.querySelectorAll("#modal-tool-overlay, #sidebar-overlay").forEach(el=>{el.style.display="none";el.classList.remove("active");el.style.opacity="";el.style.zIndex=""})});function forceRepaint(el){if(el){const originalDisplay=el.style.display;el.style.display="none";el.offsetHeight;el.style.display=originalDisplay;console.log(`Index: Forced repaint on element: ${el.tagName}`)}}function updateVh(){const vh=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${vh}px`)}window.addEventListener("load",updateVh);window.addEventListener("resize",updateVh);